<script>
  import fastapi from "../lib/api";
  import { link } from 'svelte-spa-router'
  import { onMount } from "svelte";

  let url = "";
  let preset = "주통기";
  let selectedVulnerabilities = [];
  let showVulnerabilities = false;

  function handleSubmit(event) {
    event.preventDefault();
    const params = new URLSearchParams();
    params.append("url", url);
    params.append("preset", preset);

    // Navigate to analysis page (dummy navigation for this example)
    window.location.href = `/analysis?${params.toString()}`;
  }

  function handleAnalyze() {
    selectedVulnerabilities = [];
    document.querySelectorAll(".vulnerability-item input:checked").forEach((item) => {
      selectedVulnerabilities.push(item.nextElementSibling.textContent);
    });
  }

  function showOptions() {
    showVulnerabilities = !showVulnerabilities;
  }

  onMount(() => {
    const params = new URLSearchParams(window.location.search);
  });
</script>

<style>
  @import url("https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap");

  .container {
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    margin-top: 50px;
  }

  header {
    text-align: center;
    margin-bottom: 30px;
  }

  header h1 {
    font-size: 24px;
    color: #333;
  }

  .form-group {
    margin-bottom: 15px;
  }

  label {
    display: block;
    margin-bottom: 5px;
    color: #333;
  }

  input[type="text"],
  select {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }

  .btn {
    display: block;
    width: 100%;
    padding: 10px 0;
    margin-top: 20px;
    background-color: #0047ab;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    font-size: 16px;
    text-align: center;
  }

  .btn:hover {
    background-color: #003580;
  }

  .vulnerability-list {
    max-height: 600px;
    overflow-y: auto;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
    background-color: #fff;
  }

  .vulnerability-item {
    display: flex;
    align-items: center;
    padding: 10px;
    border-bottom: 1px solid #ddd;
  }

  .vulnerability-item:last-child {
    border-bottom: none;
  }

  .vulnerability-item input {
    margin-right: 10px;
  }

  .vulnerability-item label {
    color: #333;
  }

  .Terms {
  display: flex;
  align-items: center;
  }
</style>

<div class="container">
  <header>
    <h1>시나리오 기반 AI 웹 취약점 분석</h1>
    <form on:submit={handleSubmit} id="main-form">
      <div class="form-group">
        <label for="url-input">웹사이트 URL 입력</label>
        <input type="text" id="url-input" bind:value={url} placeholder="URL을 입력하세요" required />
      </div>
      <div class="Terms">
        <input type="checkbox" id="Terms" />
        <label for="Terms">허가 받지 않은 분석 시도는 처벌받을 수 있습니다. 사이트 관계자인 경우에만 검사를 진행하세요.</label>
        <a href="/terms" use:link>약관 보기</a>
      </div>
      <div class="form-group">
        <label for="preset-select">분석 기준 선택</label>
        <select id="preset-select" bind:value={preset}>
          <option value="주통기">주통기</option>
          <option value="OWASP Top10">OWASP Top10</option>
          <option value="CVE">CVE</option>
        </select>
      </div>
      <div class="form-group">
        <button type="button" id="custom-select" on:click={showOptions}>
          추가 옵션 보기
        </button>
      </div>
      {#if showVulnerabilities}
        <div class="vulnerability-list">
          <!-- Add some sample vulnerabilities for demonstration -->
          <div class="vulnerability-item">
            <input type="checkbox" id="vul1" />
            <label for="vul1">취약점 1</label>
          </div>
          <div class="vulnerability-item">
            <input type="checkbox" id="vul2" />
            <label for="vul2">취약점 2</label>
          </div>
          <div class="vulnerability-item">
            <input type="checkbox" id="vul3" />
            <label for="vul3">취약점 3</label>
          </div>
        </div>
      {/if}
      <a href="/analysis" class="btn" use:link>다음</a>
    </form>
  </header>
  <button class="btn analyze-btn" on:click={handleAnalyze}>
    분석 시작
  </button>
</div>
